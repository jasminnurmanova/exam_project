{% extends 'base.html' %}
{% load static %}

{% block title %}Profile{% endblock %}

{% block content %}

<!-- ================= PROFILE INFO ================= -->
<div class="profile-card">
    <div class="profile-image">
        {% if request.user.image %}
            <img src="{{ request.user.image.url }}">
        {% else %}
            <img src="{% static 'default_user.png' %}">
        {% endif %}
    </div>

    <div class="profile-info">
        <h2>{{ request.user.first_name }} {{ request.user.last_name }}</h2>
        <p>@{{ request.user.username }}</p>
    </div>
</div>

<!-- ================= PRODUCTS + COMMENTS ================= -->
<div class="page-layout">

    <!-- ================= LEFT: PRODUCTS ================= -->
    <div class="left">
        <h3>My Products</h3>

        {% for product in products %}
            <a href="{% url 'detail' product.pk %}" class="product-link">
                <div class="product">
                    {% if product.image %}
                        <img src="{{ product.image.url }}">
                    {% endif %}
                    <h4>{{ product.name }}</h4>
                    <p>{{ product.price }} $</p>
                    <small>{{ product.metal }}</small>
                </div>
            </a>
        {% empty %}
            <p>No products yet</p>
        {% endfor %}
    </div>

    <!-- ================= RIGHT: COMMENTS ================= -->
    <div class="right">
        <h3>Comments</h3>

        {% for comment in comments %}
            <div class="comment-card">

                <!-- USER -->
                <div class="comment-user">
                    {% if comment.user.image %}
                        <img src="{{ comment.user.image.url }}">
                    {% else %}
                        <img src="{% static 'default_user.png' %}">
                    {% endif %}

                    <div>
                        <strong>{{ comment.user.username }}</strong><br>
                        <small>{{ comment.created_at|date:"d M Y H:i" }}</small>
                    </div>
                </div>

                <!-- RATE -->
                {% if comment.rate > 0 %}
                    <div class="comment-rate">
                        {% for i in "12345"|slice:":comment.rate" %}
                            ‚≠ê
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- TEXT -->
                <p class="comment-text">{{ comment.text }}</p>

                <!-- IMAGE -->
                {% if comment.image_comment %}
                    <img src="{{ comment.image_comment.url }}" class="comment-image">
                {% endif %}

            </div>
        {% empty %}
            <p>No comments yet</p>
        {% endfor %}
    </div>

</div>

<style>

/* PROFILE */
.profile-card {
    display: flex;
    align-items: center;
    gap: 20px;
    background: #fff8e1;
    padding: 20px;
    border-radius: 12px;
    max-width: 600px;
    margin: 20px auto;
}

.profile-image img {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    object-fit: cover;
}

/* LAYOUT */
.page-layout {
    display: flex;
    gap: 30px;
    margin-top: 40px;
}

/* LEFT */
.left {
    flex: 2;
}

/* RIGHT */
.right {
    flex: 1;
}

/* PRODUCT */
.product-link {
    text-decoration: none;
    color: inherit;
}

.product {
    background: #ffffff;
    padding: 15px;
    border-radius: 12px;
    margin-bottom: 15px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.product img {
    width: 100%;
    height: 180px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 10px;
}

/* COMMENT */
.comment-card {
    background: #f5f5f5;
    padding: 12px;
    border-radius: 12px;
    margin-bottom: 15px;
}

.comment-user {
    display: flex;
    align-items: center;
    gap: 10px;
}

.comment-user img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

.comment-rate {
    color: #f2b01e;
    margin: 6px 0;
}

.comment-text {
    margin: 8px 0;
}

.comment-image {
    max-width: 100%;
    border-radius: 10px;
    margin-top: 8px;
}

/* MOBILE */
@media (max-width: 768px) {
    .page-layout {
        flex-direction: column;
    }
}

</style>

{% endblock %}
